#$$LIC$$
#
# $Id: Makefile.in 996 2009-03-19 18:14:44Z csc $
# 
# Makefile
SHELL = @SHELL@

srcdir = @srcdir@
top_srcdir = @top_srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@

bindir = @bindir@
sbindir = @sbindir@
libexecdir = @libexecdir@
datadir = @datadir@
datarootdir = @datarootdir@
libdir = @libdir@
mandir = @mandir@
includedir = @includedir@
top_builddir = .

INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@
INSTALL_SCRIPT = @INSTALL_SCRIPT@
INSTALL_HEADER = $(INSTALL_DATA)
CC = @CC@
EXEEXT = @EXEEXT@
OBJEXT = @OBJEXT@
PACKAGE = @PACKAGE_NAME@
VERSION = @PACKAGE_VERSION@
install_sh = @install_sh@
OPENSSL = @OPENSSL@

DEFS = @DEFS@ 
CPPFLAGS = @CPPFLAGS@
LDFLAGS = @LDFLAGS@ -L../libmisc
LIBS = @LIBS@ -lmisc
CCOPT = -Wall -g -fPIC
INCLS = -I. -I.. -I../libmisc
CFLAGS = $(CCOPT) $(INCLS) $(DEFS)

TARGETS = libipfix.a libipfix.so ipfix_reverse_fields.h ipfix_def_fokus.h ipfix_fields_fokus.h 
SOURCES = ipfix.c ipfix_col.c ipfix_col_db.c ipfix_col_files.c ipfix_print.c
OBJECTS = $(SOURCES:.c=.o) @IPFIX_DB_OBJ@ @IPFIX_SSL_OBJ@
DHPARAMS = dh512.pem dh1024.pem
CLEANFILES = $(TARGETS) *.d *.o *.so *.so.$(VERSION)
DISTCLEANFILES = $(CLEANFILES) $(DHPARAMS) Makefile


include ../Makefile.rules

dh%.pem:
	$(OPENSSL) dhparam -check -text -5 $* -out $@

dhparams.c: $(DHPARAMS) 
	echo "#include <openssl/ssl.h>" > $@
	echo "#include <openssl/x509v3.h>" >> $@
	$(OPENSSL) dh -noout -C < dh512.pem >> $@ 
	$(OPENSSL) dh -noout -C < dh1024.pem >> $@ 

ipfix_reverse_fields.h: ipfix_fields.h make-reverse-IPFIX_FIELDS_H.sed-script-file
	sed -f make-reverse-IPFIX_FIELDS_H.sed-script-file $< > $@

ipfix_%_fokus.h: ipfix_FOKUS_IEs.txt make-ipfix_%_fokus_h.awk
	awk -f make-ipfix_$*_fokus_h.awk $< > $@

install:
	#install libraries
	@[ -d $(DESTDIR)${libdir} ] || (mkdir -p $(DESTDIR)${libdir}; chmod 755 $(DESTDIR)${libdir})
	$(INSTALL_DATA) $(TARGETS) $(DESTDIR)/${libdir}/
	#install header
	@[ -d $(DESTDIR)${includedir} ] || (mkdir -p $(DESTDIR)${includedir}; chmod 755 $(DESTDIR)${includedir})
	$(INSTALL_HEADER) ipfix*.h $(DESTDIR)${includedir}/
#	#shared library TODO 
#	$(INSTALL_DATA) libipfix.so.$(VERSION) $(DESTDIR)${libdir}/
#	ln -s $(DESTDIR)${libdir}/libipfix.so.$(VERSION) $(DESTDIR)${libdir}/libipfix.so

